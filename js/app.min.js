$.ajaxPrefilter(function(a,b,c){"jsonp"!=a.dataType&&"jsonp"!=b.dataType||(a.cache=!0)});var ViewModel=function(){function d(){var a=new google.maps.StyledMapType(styles,{name:"Styled Map"});c=new google.maps.LatLng(47.405389,8.39977);var b={zoom:15,center:c,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}};"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(function(a){lat=a.coords.latitude,lng=a.coords.longitude},function(a){console.log("Error: "+a.message)}),map=new google.maps.Map(document.getElementById("map-canvas"),b),map.mapTypes.set("map_style",a),map.setMapTypeId("map_style");var d='<div id="content"><div id="siteNotice"></div><h2 id="firstHeading" class="firstHeading">Home Sweet Home</h2><h4>Dietikon, ZH</h4><div id="bodyContent"><p>I live here and love to code. This App has been developed with JavaScript, jQuery, Knockout.js, Google Maps API and yelp! API</p><hr><p><a class="btn btn-danger" href="https://github.com/h-ARTS/Neighborhood-Map" target="_blank" alt="Check this projects repository!">Check Repository</a></p></div></div>',e=new google.maps.InfoWindow({content:d}),f=new google.maps.Marker({position:c,map:map,animation:google.maps.Animation.DROP,title:"Home sweet Home"});google.maps.event.addListener(f,"click",function(){e.open(map,f)})}var a=this;this.listings=ko.observableArray([]);var b,c;google.maps.event.addDomListener(window,"load",d),this.search=function(){var a=$("#address").val(),b=$("#what").val();f(a),g(b,a)};var f=function(a){b=new google.maps.Geocoder,b.geocode({address:a},function(a,b){b==google.maps.GeocoderStatus.OK?map.setCenter(a[0].geometry.location):console.log("Geocode was not successful for the following reason: "+b)})},g=function(b,c){var d={consumerKey:"sMc_bXUDXLpO0IvHpIrG_g",consumerSecret:"0id8i3-vmxeWLN5DJ9-DxiuHqSs",accessToken:"dvNEhY8CDbC8bF4M4tAn_FGgudCA_PG9",accessTokenSecret:"QvZMdv3qSnBlFnw4rHkgwzQUujE",serviceProvider:{signatureMethod:"HMAC-SHA1"}},e={consumerSecret:d.consumerSecret,tokenSecret:d.accessTokenSecret},f=[];f.push(["term",b]),f.push(["location",c]),f.push(["callback","cb"]),f.push(["oauth_consumer_key",d.consumerKey]),f.push(["oauth_consumer_secret",d.consumerSecret]),f.push(["oauth_token",d.accessToken]),f.push(["oauth_signature_method","HMAC-SHA1"]);var g={action:"https://api.yelp.com/v2/search",method:"GET",parameters:f};console.log(f),OAuth.setTimestampAndNonce(g),OAuth.SignatureMethod.sign(g,e);var h=OAuth.getParameterMap(g.parameters);console.log(h),$.ajax({url:g.action,data:h,dataType:"jsonp",cached:!0,jsonpCallback:"cb",success:function(b,c,d){clearMarkers(),a.listings.removeAll(),console.log(b);for(var e=b.businesses.length,f=0;f<e;f++)a.listings.push(new Listing(b.businesses[f]));console.log(a.listings()),showMarkers()}}).fail(function(a){console.log("something went wrong: "),console.log(a.error())})}},map,markers=[],clearMarkers=function(){setAllMap(null),markers=[]},showMarkers=function(){setAllMap(map)},setAllMap=function(a){for(var b=markers.length,c=0;c<b;c++)markers[c].setMap(a)},addMarker=function(a){markers.push(a)},makeMarker=function(a,b){var c=new google.maps.LatLng(a.latitude,a.longitude),d=new google.maps.InfoWindow({content:b}),e=new google.maps.Marker({position:c,animation:google.maps.Animation.DROP});return google.maps.event.addListener(e,"mouseover",function(){d.open(map,e)}),google.maps.event.addListener(e,"mouseout",function(){d.close(map,e)}),e},bounce=function(a){a.setAnimation(google.maps.Animation.BOUNCE)},stopBounce=function(a){a.setAnimation(null)},Listing=function(a){this.display_phone=ko.observable(a.display_phone),this.image_url=ko.observable(a.image_url),this.location=ko.observable(a.location.address[0]),this.name=ko.observable(a.name),this.url=ko.observable(a.url),this.snippet_text=ko.observable(a.snippet_text),this.marker=makeMarker(a.location.coordinate,a.name+"<br>"+a.location.address[0]),addMarker(this.marker),this.show=function(){bounce(this.marker)},this.hide=function(){stopBounce(this.marker)}};ko.applyBindings(new ViewModel);