$.ajaxPrefilter(function(e,o,n){("jsonp"==e.dataType||"jsonp"==o.dataType)&&(e.cache=!0)});var ViewModel=function(){function e(){var e=new google.maps.StyledMapType(styles,{name:"Styled Map"});a=new google.maps.LatLng(47.405389,8.39977);var o={zoom:15,center:a,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}};"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(function(e){lat=e.coords.latitude,lng=e.coords.longitude},function(e){console.log("Error: "+e.message)}),map=new google.maps.Map(document.getElementById("map-canvas"),o),map.mapTypes.set("map_style",e),map.setMapTypeId("map_style");var n='<div id="content"><div id="siteNotice"></div><h1 id="firstHeading" class="firstHeading">Home sweet Home</h1><h4>In Dietikon</h4><div id="bodyContent"><p><b>My Home</b>, temporary living with my friend. I moved to this place since march 2016. Now searching for new opportunities in Web Dev industry. Udacity made me possible to become a proffessional Front-End Web Developer for my carrier and continued with other online courses such as AngularJS in codecademy or in codeschool. Without the ability to learn I would never reach this stage. </p><hr><p>This is by the way one of my project called "The neighbourhood map". I hope you are enjoying.<br> Thanks for visiting my place! :)</p><p>Udacity, <a href="https://www.udacity.com">www.udacity.com</a></p></div></div>',t=new google.maps.InfoWindow({content:n}),s=new google.maps.Marker({position:a,map:map,animation:google.maps.Animation.DROP,title:"Home sweet Home"});google.maps.event.addListener(s,"click",function(){t.open(map,s)})}var o=this;this.listings=ko.observableArray([]);var n,a;google.maps.event.addDomListener(window,"load",e),this.search=function(){var e=$("#address").val(),o=$("#what").val();t(e),s(o,e)};var t=function(e){n=new google.maps.Geocoder,n.geocode({address:e},function(e,o){o==google.maps.GeocoderStatus.OK?map.setCenter(e[0].geometry.location):console.log("Geocode was not successful for the following reason: "+o)})},s=function(e,n){var a={consumerKey:"sMc_bXUDXLpO0IvHpIrG_g",consumerSecret:"0id8i3-vmxeWLN5DJ9-DxiuHqSs",accessToken:"dvNEhY8CDbC8bF4M4tAn_FGgudCA_PG9",accessTokenSecret:"QvZMdv3qSnBlFnw4rHkgwzQUujE",serviceProvider:{signatureMethod:"HMAC-SHA1"}},t={consumerSecret:a.consumerSecret,tokenSecret:a.accessTokenSecret},s=[];s.push(["term",e]),s.push(["location",n]),s.push(["callback","cb"]),s.push(["oauth_consumer_key",a.consumerKey]),s.push(["oauth_consumer_secret",a.consumerSecret]),s.push(["oauth_token",a.accessToken]),s.push(["oauth_signature_method","HMAC-SHA1"]);var i={action:"https://api.yelp.com/v2/search",method:"GET",parameters:s};console.log(s),OAuth.setTimestampAndNonce(i),OAuth.SignatureMethod.sign(i,t);var r=OAuth.getParameterMap(i.parameters);console.log(r),$.ajax({url:i.action,data:r,dataType:"jsonp",cached:!0,jsonpCallback:"cb",success:function(e,n,a){clearMarkers(),o.listings.removeAll(),console.log(e);for(var t=e.businesses.length,s=0;t>s;s++)o.listings.push(new Listing(e.businesses[s]));console.log(o.listings()),showMarkers()}}).fail(function(e){console.log("something went wrong: "),console.log(e.error())})}},map,markers=[],clearMarkers=function(){setAllMap(null),markers=[]},showMarkers=function(){setAllMap(map)},setAllMap=function(e){for(var o=markers.length,n=0;o>n;n++)markers[n].setMap(e)},addMarker=function(e){markers.push(e)},makeMarker=function(e,o){var n=new google.maps.LatLng(e.latitude,e.longitude),a=new google.maps.InfoWindow({content:o}),t=new google.maps.Marker({position:n,animation:google.maps.Animation.DROP});return google.maps.event.addListener(t,"mouseover",function(){a.open(map,t)}),google.maps.event.addListener(t,"mouseout",function(){a.close(map,t)}),t},bounce=function(e){e.setAnimation(google.maps.Animation.BOUNCE)},stopBounce=function(e){e.setAnimation(null)},Listing=function(e){this.display_phone=ko.observable(e.display_phone),this.image_url=ko.observable(e.image_url),this.location=ko.observable(e.location.address[0]),this.name=ko.observable(e.name),this.url=ko.observable(e.url),this.snippet_text=ko.observable(e.snippet_text),this.marker=makeMarker(e.location.coordinate,e.name+"<br>"+e.location.address[0]),addMarker(this.marker),this.show=function(){bounce(this.marker)},this.hide=function(){stopBounce(this.marker)}};ko.applyBindings(new ViewModel);